<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue Prop Type Validation | Pine Wu&#39;s Blog</title>
    <meta name="description" content="Pine Wu&#39;s Blog">
    <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/style.css">
    
    
    
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="f6"><header id="header" class="measure-wide center mt6 mb4"><nav><div class="mb2 dib"><a href="/" title="blog" class="gray link active">blog</a>
      .
      <a href="/about" title="matsu" class="gray link">matsu</a></div><div><a href="/feed.xml" title="matsu" class="rss gray link">/rss</a></div></nav></header><section id="main" class="page-post gray mb6 lh-copy"><ul class="ph0"><li class="flex justify-between pb3"><a href="/vue-prop-type-validation" class="link">Vue Prop Type Validation</a><span class="date gray">2020-09-23</span></li></ul><div class="content custom"><p>Since <a href="https://github.com/vuejs/vetur/releases/tag/v0.28.0">0.28.0</a>, Vetur offers cross-file Prop Type Validation.</p><p>Docs are <a href="https://vuejs.github.io/vetur/interpolation.html#prop-type-validation">here</a>. In short, this works with:</p><ul><li><code>export default {...}</code> in JS files</li><li><code>defineComponent</code> in TS files with Vue 3</li><li><code>Vue.extend</code> in TS files with Vue 2</li><li>TS types defined with <a href="https://vuejs.org/v2/guide/typescript.html#Annotating-Props"><code>Vue.PropType</code></a></li></ul><p>You can use <a href="https://vuejs.github.io/vetur/vti.html">VTI</a> to get validation errors on CLI.</p><p>Some todos I plan to work on:</p><ul><li>Make updates in <code>Child.vue</code> refresh <code>Parent.vue</code>'s diagnostics</li><li>Make <code>v-model</code>, dynamic <code>v-bind</code>, object <code>v-bind</code> work</li><li>Allow renaming props</li><li>Allow <a href="https://vuejs.github.io/vetur/component-data.html">Component Data</a> to define types. For example, if <a href="https://router.vuejs.org/api/#name"><code>name</code></a> of <code>router-view</code> element is defined as:<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #005CC5">&quot;name&quot;</span><span style="color: #000000">: {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #005CC5">&quot;type&quot;</span><span style="color: #000000">: </span><span style="color: #032F62">&quot;string&quot;</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #005CC5">&quot;description&quot;</span><span style="color: #000000">: </span><span style="color: #032F62">&quot;When a `&lt;router-view&gt;` has a `name` prop...&quot;</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre>then <code>&lt;router-view&gt; :name=&quot;42&quot;</code> should generate an error.</li></ul><p>Here's a quick demo. You can also clone <a href="https://github.com/octref/vue-prop-type-validation">octref/vue-prop-type-validation</a> to play with it:</p><video autoplay="autoplay" loop="loop" muted="muted" playsinline controls="controls"><source src="/vue-prop-type-validation/vue-prop-type-validation.mp4" type="video/mp4"></video><p>In the remainder of this post, I'll touch upon these topics:</p><ul><li><a href="#why-prop-type-validation">Why Prop Type Validation</a></li><li><a href="#how-prop-type-validation-works">How Prop Type Validation works</a></li><li><a href="#sponsorship-and-continued-development">Sponsorship and future development</a></li></ul><h2 id="why-prop-type-validation">Why Prop Type Validation</h2><p>To understand Prop Type Validation's benefits, let's take a look at two things. Vue's <a href="https://vuejs.org/v2/guide/components-props.html#Type-Checks">prop type check</a> and TypeScript's benefits.</p><p>Vue's prop type check doesn't use TypeScript types and doesn't generate errors on either IDE or CLI. If you pass a boolean to a string prop, you only get a warning in the browser console:</p><p></p><figure><img src="/vue-prop-type-validation/vue-prop-type-check-error.png" alt="browser error"></figure><p></p><p>For TypeScript users, this doesn't suffice. When people ask for &quot;TypeScript support&quot;, what they really mean is &quot;tooling support&quot;. Compiler that checks types. IDE that reveals type errors. Auto-completion of all properties in an object. Hover that shows type information. Reliable rename that works across the codebase.</p><p>When you are working on a pure TypeScript codebase, you feel every file is covered by the type system. If changing a type generates 20 errors, fixing these 20 errors is all you need to do to get the code running again. Not one more, not one less.</p><p>A Vue project, even written in TypeScript, still contains template code that is not covered by the type system. Sure you can write TSX, but Vue people like SFC and Vue templates. When you add, rename, change-type-of a prop, you do not know how many errors will such a change generate, and where such errors are. This limits your ability to refactor, which is essential to keeping a large codebase clean and organized.</p><p>Vetur's Prop Type Validation fills the gap. Together with <a href="/generic-vue-template-interpolation-language-features">Generic Vue Template Interpolation Language Features</a>, Vetur now provides auto-completion, type checking, jump-to-definition and find-references for Vue Single File Components. Refactor and rename need more work, but they'll come as well.</p><p>Additionally:</p><ul><li><a href="https://www.npmjs.com/package/vls">VLS</a> makes these features available to any <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a> compatible clients.</li><li><a href="https://www.npmjs.com/package/vti">VTI</a> surfaces prop validation errors on the command line (so you can use them in Continuous Integration).</li><li>(WIP) Component Data will allow libraries to specify component attribute type, with which Vetur will perform Prop Type Validation.</li></ul><p>This is similar to the TypeScript ecosystem:</p><ul><li>VLS -&gt; <a href="https://github.com/Microsoft/TypeScript/wiki/Standalone-Server-(tsserver)">TSServer</a></li><li>VTI -&gt; <code>tsc</code></li><li>Component Data -&gt; <code>d.ts</code> files and <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a></li></ul><p>With Prop Type Validation, I hope Vetur can help you navigate through complex Vue codebases and make changes with confidence.</p><h2 id="how-prop-type-validation-works">How Prop Type Validation works</h2><p>When you are editing a <code>.vue</code> file in <a href="https://github.com/vuejs/vetur">Vetur</a>, you can run the command <code>Vetur: Show corresponding virtual file and sourcemap</code> to view the internal TypeScript representation of the Vue file. This virtual TypeScript file powers Vetur's <a href="https://vuejs.github.io/vetur/interpolation.html">Interpolation Support</a>, and is now extended to support Prop Type Validation.</p><p>Given two Vue files, such as <a href="https://github.com/octref/vue-prop-type-validation/blob/master/src/Child.vue">Child.vue</a> and <a href="https://github.com/octref/vue-prop-type-validation/blob/master/src/Parent.vue">Parent.vue</a>:</p><pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">&lt;!-- Child.vue --&gt;</span></span>
<span class="line"><span style="color: #000000">&lt;</span><span style="color: #22863A">script</span><span style="color: #000000"> </span><span style="color: #6F42C1">lang</span><span style="color: #000000">=</span><span style="color: #032F62">&quot;ts&quot;</span><span style="color: #000000">&gt;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #000000"> </span><span style="color: #24292E">Vue</span><span style="color: #000000">, { </span><span style="color: #24292E">PropType</span><span style="color: #000000"> } </span><span style="color: #D73A49">from</span><span style="color: #000000"> </span><span style="color: #032F62">'vue'</span></span>

<span class="line"><span style="color: #D73A49">export</span><span style="color: #000000"> </span><span style="color: #D73A49">default</span><span style="color: #000000"> </span><span style="color: #24292E">Vue</span><span style="color: #000000">.</span><span style="color: #6F42C1">extend</span><span style="color: #000000">({</span></span>
<span class="line"><span style="color: #000000">  props: {</span></span>
<span class="line"><span style="color: #000000">    str: </span><span style="color: #005CC5">String</span><span style="color: #000000"> </span><span style="color: #D73A49">as</span><span style="color: #000000"> </span><span style="color: #6F42C1">PropType</span><span style="color: #000000">&lt;</span><span style="color: #032F62">'foo'</span><span style="color: #000000"> </span><span style="color: #D73A49">|</span><span style="color: #000000"> </span><span style="color: #032F62">'bar'</span><span style="color: #000000">&gt;,</span></span>
<span class="line"><span style="color: #000000">    num: </span><span style="color: #005CC5">Number</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">})</span></span>
<span class="line"><span style="color: #000000">&lt;/</span><span style="color: #22863A">script</span><span style="color: #000000">&gt;</span></span></code></pre><pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">&lt;!-- Parent.vue --&gt;</span></span>
<span class="line"><span style="color: #000000">&lt;</span><span style="color: #22863A">template</span><span style="color: #000000">&gt;</span></span>
<span class="line"><span style="color: #000000">  &lt;</span><span style="color: #22863A">child</span><span style="color: #000000"> :</span><span style="color: #6F42C1">str</span><span style="color: #000000">=</span><span style="color: #032F62">&quot;</span><span style="color: #24292E">myStr</span><span style="color: #032F62">&quot;</span><span style="color: #000000"> :</span><span style="color: #6F42C1">num</span><span style="color: #000000">=</span><span style="color: #032F62">&quot;</span><span style="color: #005CC5">42</span><span style="color: #032F62">&quot;</span><span style="color: #000000">&gt;&lt;/</span><span style="color: #22863A">child</span><span style="color: #000000">&gt;</span></span>
<span class="line"><span style="color: #000000">&lt;/</span><span style="color: #22863A">template</span><span style="color: #000000">&gt;</span></span>

<span class="line"><span style="color: #000000">&lt;</span><span style="color: #22863A">script</span><span style="color: #000000">&gt;</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #000000"> </span><span style="color: #24292E">Child</span><span style="color: #000000"> </span><span style="color: #D73A49">from</span><span style="color: #000000"> </span><span style="color: #032F62">'./Child.vue'</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #000000"> </span><span style="color: #D73A49">default</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  components: {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #24292E">Child</span></span>
<span class="line"><span style="color: #000000">  },</span></span>
<span class="line"><span style="color: #000000">  props: {</span></span>
<span class="line"><span style="color: #000000">    myStr: </span><span style="color: #005CC5">String</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    myNum: </span><span style="color: #005CC5">Number</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #000000">&lt;/</span><span style="color: #22863A">script</span><span style="color: #000000">&gt;</span></span></code></pre><p>Vetur roughly translates <code>Parent.vue</code> into <a href="https://github.com/octref/vue-prop-type-validation/blob/master/src/parent-vue-transformed.ts"><code>parent-vue-transformed.ts</code></a>:</p><pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">// parent-vue-transformed.ts</span></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #000000"> </span><span style="color: #24292E">Vue</span><span style="color: #000000"> </span><span style="color: #D73A49">from</span><span style="color: #000000"> </span><span style="color: #032F62">'vue'</span></span>

<span class="line"><span style="color: #D73A49">const</span><span style="color: #000000"> </span><span style="color: #005CC5">__vlsComponent</span><span style="color: #000000"> </span><span style="color: #D73A49">=</span><span style="color: #000000"> </span><span style="color: #24292E">Vue</span><span style="color: #000000">.</span><span style="color: #6F42C1">extend</span><span style="color: #000000">({</span></span>
<span class="line"><span style="color: #000000">  props: {</span></span>
<span class="line"><span style="color: #000000">    myStr: </span><span style="color: #005CC5">String</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    myNum: </span><span style="color: #005CC5">Number</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">})</span></span>

<span class="line"><span style="color: #D73A49">export</span><span style="color: #000000"> </span><span style="color: #D73A49">declare</span><span style="color: #000000"> </span><span style="color: #D73A49">const</span><span style="color: #000000"> </span><span style="color: #005CC5">__vlsRenderHelper</span><span style="color: #D73A49">:</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  &lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt;(</span><span style="color: #E36209">Component</span><span style="color: #D73A49">:</span><span style="color: #000000"> (</span><span style="color: #D73A49">new</span><span style="color: #000000"> (</span><span style="color: #D73A49">...</span><span style="color: #E36209">args</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span><span style="color: #000000">[]) </span><span style="color: #D73A49">=&gt;</span><span style="color: #000000"> </span><span style="color: #6F42C1">T</span><span style="color: #000000">), </span><span style="color: #6F42C1">fn</span><span style="color: #D73A49">:</span><span style="color: #000000"> (</span><span style="color: #005CC5">this</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #6F42C1">T</span><span style="color: #000000">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span><span style="color: #000000">)</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">};</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #000000"> </span><span style="color: #D73A49">interface</span><span style="color: #000000"> </span><span style="color: #6F42C1">__vlsComponentData</span><span style="color: #000000">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #E36209">props</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #6F42C1">Record</span><span style="color: #000000">&lt;</span><span style="color: #005CC5">string</span><span style="color: #000000">, </span><span style="color: #005CC5">any</span><span style="color: #000000">&gt;;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #D73A49">interface</span><span style="color: #000000"> </span><span style="color: #6F42C1">__vlsComponentData__child</span><span style="color: #000000">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt; </span><span style="color: #D73A49">extends</span><span style="color: #000000"> </span><span style="color: #6F42C1">__vlsComponentData</span><span style="color: #000000">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt; {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #E36209">props</span><span style="color: #D73A49">:</span><span style="color: #000000"> { </span><span style="color: #E36209">str</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #032F62">'foo'</span><span style="color: #000000"> </span><span style="color: #D73A49">|</span><span style="color: #000000"> </span><span style="color: #032F62">'bar'</span><span style="color: #000000">; </span><span style="color: #E36209">num</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">number</span><span style="color: #000000">; [</span><span style="color: #E36209">other</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">string</span><span style="color: #000000">]</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span><span style="color: #000000"> }</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"><span style="color: #D73A49">declare</span><span style="color: #000000"> </span><span style="color: #D73A49">const</span><span style="color: #000000"> </span><span style="color: #005CC5">__vlsComponentHelper__child</span><span style="color: #D73A49">:</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  &lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt;(</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #E36209">vm</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #6F42C1">T</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #E36209">tag</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">string</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #E36209">data</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #6F42C1">__vlsComponentData__child</span><span style="color: #000000">&lt;</span><span style="color: #6F42C1">Record</span><span style="color: #000000">&lt;</span><span style="color: #005CC5">string</span><span style="color: #000000">, </span><span style="color: #005CC5">any</span><span style="color: #000000">&gt;&gt; </span><span style="color: #D73A49">&amp;</span><span style="color: #000000"> </span><span style="color: #6F42C1">ThisType</span><span style="color: #000000">&lt;</span><span style="color: #6F42C1">T</span><span style="color: #000000">&gt;,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #E36209">children</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span><span style="color: #000000">[]</span></span>
<span class="line"><span style="color: #000000">  )</span><span style="color: #D73A49">:</span><span style="color: #000000"> </span><span style="color: #005CC5">any</span></span>
<span class="line"><span style="color: #000000">}</span></span>

<span class="line"><span style="color: #6F42C1">__vlsRenderHelper</span><span style="color: #000000">(</span><span style="color: #24292E">__vlsComponent</span><span style="color: #000000">, </span><span style="color: #D73A49">function</span><span style="color: #000000"> () {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #6F42C1">__vlsComponentHelper__child</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #005CC5">this</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #032F62">'child'</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    { props: { str: </span><span style="color: #005CC5">this</span><span style="color: #000000">.</span><span style="color: #24292E">myStr</span><span style="color: #000000">, num: </span><span style="color: #005CC5">42</span><span style="color: #000000"> } },</span></span>
<span class="line"><span style="color: #000000">    []</span></span>
<span class="line"><span style="color: #000000">  )</span></span>
<span class="line"><span style="color: #000000">})</span></span></code></pre><p>If you open this TS file in VS Code, you'll see an error on <code>str: this.myStr</code>, saying <code>Type 'string' is not assignable to type '&quot;foo&quot; | &quot;bar&quot;'</code>.</p><p>What Vetur does is to:</p><ul><li>Collect each components' prop information and build interfaces such as <code>__vlsComponentData__child</code>.</li><li>For each parent component, transform its Vue template into TS code with its children components' interfaces
<ul><li>Meanwhile, generate a <a href="https://blog.matsu.io/generic-vue-template-interpolation-language-features#problems">sourcemap</a> from its Vue template to the transformed TS file</li></ul></li><li>Get all diagnostic errors on the transformed TS file</li><li>Convert the range of the diagnostics errors by mapping them back to the Vue template with the sourcemap</li></ul><h2 id="sponsorship-and-continued-development">Sponsorship and continued development</h2><p>When I <a href="https://blog.matsu.io/on-leaving">left</a> US and my work at Microsoft, I decided to give more time to my personal researches and pursuits, and only commit at most 15 hours/week to Open Source. Prop Type Validation took way more time and energy than I expected, but I still tried to finish it because I believe this feature makes Vue great. Through <a href="https://www.npmjs.com/package/vls">VLS</a>, Prop Type Validation will be made available to <a href="https://atom.io/packages/ide-vue">Atom</a>, <a href="https://packagecontrol.io/packages/LSP-vue">Sublime Text</a>, <a href="https://github.com/neoclide/coc-vetur">Vim/Neovim</a>, <a href="https://github.com/onivim/oni2/issues/1058">OniVim</a>, <a href="https://github.com/emacs-lsp/lsp-mode">Emacs</a> and <a href="https://codesandbox.io/post/announcing-codesandbox-v3">CodeSandbox</a>. I hope it helps you enjoy Vue.</p><p>I want to offer my thank-you to all my <a href="https://matsu.io/sponsors">sponsors</a>. Special thank-yous to <a href="https://github.com/ktsn">Katashin</a> who implemented the original template interpolation transformer, to <a href="https://github.com/yoyo930021">Yoyo</a> who made a lot of high-quality contributions recently to Vetur, and to <a href="https://github.com/yyx990803">Evan</a> who has been sponsoring my work while delivering a great Vue 3. Your support gives me momentum to push Vetur further.</p><p>This year I'm applying to grad school. The earliest deadline is Dec 1. I'll try to allocate some time for Vetur, but I'll have to prioritize my application over Open Source for the next few months.</p><p>With pressure from applying to graduate school and from not having a regular paying job, I find it harder and harder to commit more time to Vetur. <strong>If you find Vetur useful, please consider <a href="https://github.com/sponsors/octref">sponsoring</a> my continued development to lessen  my financial burden. Thank you.</strong></p><p><em>A map of my sponsors, <a href="https://github.com/octref/sponsors-map">updated daily</a>. I feel incredibly fortunate to be receiving support coming from five continents...thank y'all.</em></p><figure><a target="_blank" href="https://matsu.io/sponsors"><img src="/vue-prop-type-validation/sponsors.png"></a></figure></div></section></div></div>
    
  </body>
</html>
